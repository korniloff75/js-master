<p>На днях окончательно умер винчестер на системном блоке. Где-то год длились его агонии, но мне удавалось его реанимировать. Но теперь уже - только замена, в качестве которой был выбран диск Toshiba 1TB.</p>

<p>Поскольку у меня на внешнем винчестере присутствует <b>vhd</b> с полностью настроенной системой, им я и решил воспользоваться. Однако по порядку.</p>

<p>После замены hdd я загрузился с внешнего винта, инициализировал новый винт, разбил его на 2 раздела, скорее по привычке, поскольку при загрузке системы с vhd - системный раздел оказывается на виртуальном диске и физическая разбивка носителя на логические разделы уже, в принципе, не нужна. Итак, я получил готовый отформатированный винт, готовый к установке системы.</p>

<h3>Процесс переноса системы пошагово</h3>

<ol>
	<li>Скопировать vhd с <a href="/content/100.Stat'i/Windows/3.Ustanovka_VHDX/">установленной Windows</a> на целевой hdd. Копировать нужно отмонтированный образ.<br></li>
	<li>Сделать активным раздел диска, на который будет размещаться загрузчик системы. В моём случае я разместил загрузчик в тот же раздел, куда скопировал vhd.
		<ol>
			<li>Запускаем diskpart <code>diskpart</code></li>
			<li>Определяем номер нужного диска (для примера - <b>0</b>) и выбираем его <code>lis dis</code> <code>sel dis 0</code>  <br></li>
			<li>Определяем номер раздела (для примера - <b>1</b>) и выбираем его   <code>lis par</code> <code>sel par 1</code> <br></li>
			<li>Делаем раздел активным <code>active</code> </li>
		</ol>
	</li>
	<li>Далее я бы <a href="/content/100.Stat'i/Windows/5.Neubivaemaya_OS/">рекомендовал</a> создать дочерний vhd</li>
<li>Теперь приступаем к созданию загрузочных записей. Для этого нужно либо выйти из&nbsp;<i>diskpart</i>, выполнив <code>exit</code>, либо открыть новый экземпляр командной строки. Далее предположим, что буква активного раздела - <b>F:</b>
	<ol>
		<li><code>bootsect /nt60 F: /mbr</code></li>
		<li><code>bcdboot c:\windows /s F: /f all</code></li>
		<li><code>bcdedit /store F:\boot\bcd</code></li>
	</ol>
</li>

<li>
	Теперь нужно отредактировать созданную загрузочную запись, указав в ней, что загрузка будет производиться именно с <b>vhd</b>. Для этого также будет использоваться утилита командной строки <i>bcdedit</i>.<br>
	<ol>
		<li>Прописываем название, которое будет отображаться в меню выбора загрузчика <code>bcdedit /store F:\boot\bcd /set {default} description "Windows 8.1x64 7mode VHD"</code></li>
		<li>Прописываем абсолютный путь к виртуальному диску с соблюдением указанного синтаксиса. Квадратные скобки обязательны! <code>bcdedit /store F:\boot\bcd /set {default} device vhd="[F:]\vhd\W8.1x64_7mode_diff.vhdx"</code></li>
		<li>Практически то же, что в предыдущем пункте, за исключением смены device на osdevice <code>bcdedit /store F:\boot\bcd /set {default} osdevice vhd="[F:]\vhd\W8.1x64_7mode_diff.vhdx"</code></li>
	</ol>
</li>
</ol>


<h3>Завершение</h3>

<p>Всё. Теперь остаётся выключить компьютер, извлечь из него USB внешнего диска, и снова включить. Далее наслаждаемся работой системы на новом HDD, загружающейся с виртуально диска, скопированного на него ранее.</p>

<p>Если ОС была правильно установлена на VD, она будет грузиться с виртуального диска C:.</p>

<p>Все описанные операции были произведены лично мной на реальном HDD.<br></p>