		<p>Если у вас получилось успешно установить ОС Windows на виртуальный диск и, при этом, вы воспользовались моими рекомендациями и создали именно динамический виртуальный диск, пришло время убедиться, что всё проделанное было не зря.</p>
<p>Став обладателем такой системы вы можете смело забыть про всевозможные бэкаперы и антивирусы. Если пользоваться системой по изложенной ниже инструкции, они станут просто не нужны.</p>
<p>Интересен факт, что, если вы исследовали другие источники информации по данному вопросу, вы уже знаете, что дочерний диск можно назначить любому другому виртуальному диску. В том числе и фиксированному. И мои рекомендации относительно создания именно динамического диска, возможно, были вами проигнорированы. Если всё так, то дальше не читайте, и продолжайте оставаться при своём мнении, поскольку у вас всё равно не получится добиться успеха после выполнения следующих инструкций.</p>


<h3>Зачем нужен разностный диск</h3>

<p>Итак, вы уже имеете файл динамического виртуального диска <a href="/?Windows___Виртуальные_диски___Создание_виртуального_диска">Win8.1.vhdx</a> с установленной операционной системой. Можно в дальнейшем использовать и его, но такое использование будет иметь ряд недостатков:</p>
<ol>
	<li>Система на таком диске ничуть не лучше защищена, чем установленная на физическом носителе. Ну, разве что процесс резервного копироания намного проще. Но всё также вирусы могут повредить её ядро.
	<li>При использовании единого файла виртуального диска было бы разумнее его делать фиксированного типа, как это рекомендуют множество специалистов. В это случае я бы с ними согласился.
	<li>При установке незнакомого софта на такую систему всё также желательно использование виртуальных машин, поскольку она уязвима перед устанавливаемыми программами.
</ol>
<p>Если мы с вами хотим создать именно <em>неубиваемую</em> систему, которой не страшны ни вирусы, ни юзвери, нам нужно разделить её как минимум на 2 части. В одной части должны храниться файлы, изменение которых запрещено в любом случае. Во второй же части должны храниться изменяемые файлы. Между этими двумя частями должна быть связь, точнее говоря, вторая часть должна получать информацию из первой только в режиме <em>readonly</em>.</p>
<p>Ну, а чтобы эксперементировать с такой системой, не теряя возможности очень быстро вернуться к её первоначальному состоянию, вторая часть должна эмулировать изменения файлов первой части, но хранить их исключительно в себе.</p>
<p>Также важным моментом является возможность сохранения внесённых изменений в основном файле. Ведь если мы устанавливаем большую программу с многочисленными настройками, и это нам удалось, было бы неверно повторять всю процедуру повторно. Но если что-то пошло не так, нужно иметь возможность быстро полностью устранить все внесённые изменения.</p>
<p>Создание разностного диска полностью удовлетворяет всем описаным условиям и лишено изложенного списка недостатков работы с единым файлом ВД. Разностный диск подключается к родительскому и принимает на себя всю его информацию, включая его букву. Пользователь, работающий с разностным диском, может совершенно не подозревать, что все внесённые им изменения находятся отдельно от основной системы. Думаю, такая возможность будет сверхполезна для любого системного администратора. А учитывая возможность создания цепочки взаимосвязанных разностных дисков, также со связью родитель - потомок, можно реализовывать очень сложные схемы сохранения / отката. Но хватит теории, надеюсь, я вас уже убедил.</p>


<h2>Создание дочернего (child) диска</h2>
<p>Далее предполагаем, что ваш файл виртуального диска с ОС Вин 8.1 расположен по пути <b>e:\vhd\Win8.1.vhdx</b>. Если это не так, то во всех последующих командах нужно будет заменить этот путь на свой.</p>
<ol>
	<li>Открываем <a href="/?Windows___Консоль">командную строку</a> с правами Администратора.
	<li>Вводим: <code>diskpart</code>
	<li>Проверяем, что виртуальный диск отключён на данный момент, для чего последовательно вводим команды, нажимая после каждой <em>Enter</em>: <code>sel vdisk file=e:\vhd\Win8.1.vhdx</code> <code>detach vdisk</code>.
	<li>Создаём файл разностного диска: <code>create vdisk file=e:\vhd\Win8.1_diff.vhdx parent=e:\vhd\Win8.1.vhdx</code>	
</ol>

<div class="core note">
  	<p>Примечание: В отличие от создания обычного диска, при создании разностного диска не требуется указания ни его размера (принимает значение родителя), ни его типа (может быть только расширяемым).</p>
</div>


<h3>Подключение созданного разностного диска в меню загрузки системы</h3>

<p>Если вы уже прописали загрузчик для файла Win8.1.vhdx, то вам нужно будет только изменить его запись, поменяв название файла с Win8.1.vhdx на созданный Win8.1_diff.vhdx</p>
<p>Для этого последовательно вводим в командной строке:</p>
<ol>
	<li><code>bcdedit /enum</code> - просматриваем существующие загрузочные записи, находим запись загрузки системы из файла <b>Win8.1.vhdx</b>, копируем её идентификатор (ПКМ - Пометить, выделяем значение идентификатора {...ID...} - Enter)
	<li><code>bcdedit /set {...ID...} description "Win8.1_diff"</code>
	<li><code>bcdedit /set {...ID...} device vhd="[E:]\vhd\Win8.1_diff.vhdx"</code>
	<li><code>bcdedit /set {...ID...} osdevice vhd="[E:]\vhd\Win8.1_diff.vhdx"</code>
</ol>
<p>Теперь, при перезагрузке компьютера, у вас будет в меню загрузки ваша система на разностном диске. Основной диск должен при этом находиться в том же каталоге. При работе с разностным диском нельзя менять содержимое основного (родительского) диска.</p>

<p>Теперь, при загрузке системы с разностного диска, все изменения будут сохранены на нём, а родительский диск будет подключён только для чтения.</p>
<p>В следующей статье я расскажу как можно объединять родительский и разностный диски для сохранения результатов работы в "неубиваемый" образ.</p>	