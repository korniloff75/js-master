function TChart(e){function z(a,b){a=new Date(a);var c=$a[a.getMonth()]+" "+a.getDate();return b?c:ab[a.getDay()]+", "+c}function h(a,b){var c=Math.abs(a);if(1E9<c&&b)return(a/1E9).toFixed(2)+"B";if(1E6<c&&b)return(a/1E6).toFixed(2)+"M";if(1E3<c&&b)return(a/1E3).toFixed(1)+"K";if(1<c){b=c.toFixed(0);a=0>a?"-":"";for(c=0;c<b.length;c++)a+=b.charAt(c),0===(b.length-1-c)%3&&(a+=" ");return a}return a.toString()}function f(a,b,c){b=document.createElement(b);c&&b.classList.add(c);a.appendChild(b);return b}
function x(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function L(a,b,c){a.addEventListener(b,c,!1)}function M(a,b){return{fromValue:a,toValue:a,value:a,startTime:0,duration:b,delay:0}}function B(a,b){a.startTime=ta;a.toValue=b;a.fromValue=a.value}function N(a){if(a.value===a.toValue)return!1;var b=(ta-a.startTime-a.delay)/a.duration;0>b&&(b=0);1<b&&(b=1);a.value=a.fromValue+(a.toValue-a.fromValue)*-b*(b-2);return!0}function ua(a){ma=k=(a.clientX-H.left)*g;na=I=(a.clientY-H.top)*g;I>m-n&&I<
m&&k>-y&&k<r+y&&(k>v-y&&k<v+y/2?O=1:k>A-y/2&&k<A+y?O=2:k>v+y/2&&k<A-y/2&&(O=3,Fa=v-k,oa=T-U))}function Ga(a){ua(a.touches[0])}function va(a){ma=(a.clientX-H.left)*g;na=(a.clientY-H.top)*g}function Ha(a){va(a.touches[0])}function aa(a){O=0}function Ia(){wa=T-U;C=(r-2*p)/wa;V=-U*C+p;for(var a=wa/ba/Ja,b=1;b<=a;)b*=2;a=b;a<t.delta?(J.delta=t.delta,J.alpha.value=1,B(J.alpha,1),t.delta=a,t.alpha.value=0,B(t.alpha,1)):a>t.delta&&(J.delta=t.delta,J.alpha.value=t.alpha.value,B(J.alpha,0),t.delta=a,t.alpha.value=
1,B(t.alpha,1))}function xa(){P=0;ca=Number.MIN_VALUE;for(var a=0;a<l.length;a++){var b=l[a];if(0!==b.alpha.toValue)for(var c=da;c<ja;c++){var d=b.data[c];d<P&&(P=d);d>ca&&(ca=d)}}ca===Number.MIN_VALUE&&(ca=1);a=ca-P;W.toValue!==a&&(B(W,a),X.delta=Q.delta,X.alpha.value=Q.alpha.value,B(X.alpha,0),Q.delta=Math.floor(W.toValue/pa),Q.alpha.value=1-X.alpha.value,B(Q.alpha,1))}function Ka(){ea=0;fa=Number.MIN_VALUE;for(var a=0;a<l.length;a++){var b=l[a];0!==b.alpha.toValue&&(b.min<ea&&(ea=b.min),b.max>
fa&&(fa=b.max))}fa===Number.MIN_VALUE&&(fa=1);B(ha,fa-ea)}function qa(a,b){var c=!1;null!==a&&U!==a&&(U=a,da=Math.floor((U-D-p/C)/ba)+1,1>da&&(da=1),c=!0);null!==b&&T!==b&&(T=b,ja=Math.ceil((T-D+p/C)/ba)+2,ja>q.data.length&&(ja=q.data.length),c=!0);c&&(Ia(),xa(),K=u=!0)}function La(a,b){if(ka!==a)if(ka=a,u=!0,null===ka)Y=-1,E.style.display="none";else{E.style.display="block";var c=Math.round((a-D)/ba)+1;1>c&&(c=1);c>q.data.length-1&&(c=q.data.length-1);if(Y!==c)for(Y=c,Ma.innerText=z(q.data[Y],!1),
c=0;c<l.length;c++){var d=l[c],f=d.data[Y];ya[c].style.display=0===d.alpha.toValue?"none":"block";za[c].innerText=h(f,!1)}c=E.getBoundingClientRect();a=(a*C+V)/g+-25;0>a&&(a=0);a+c.width>H.width&&(a=H.width-c.width);E.style.left=a+"px"}Na!==b&&(Na=b,c||(c=E.getBoundingClientRect()),a=b/g+39-c.height-Oa,0>a&&(a=b/g+39+Oa),E.style.top=a+"px")}function Pa(){H=ra.getBoundingClientRect();var a=H.width*g,b=H.height*g;if(r!==a||m!==b)r=a,m=b,F=m-n-Qa,Ja=Math.max(1,Math.floor(r/(2*Aa))),pa=Math.max(1,Math.floor(F/
bb)),ra.setAttribute("width",r),ra.setAttribute("height",m),Ia(),xa(),R=(r-2*p)/Ba,Z=-D*R+p,Ka(),u=K=!0}function Ra(a){if(!Sa){ta=a;if(null!==w&&(Pa(),0<r&&0<m)){0<O?(k+=.5*(ma-k),I+=.5*(na-I)):(k=ma,I=na);1===O?(a=k,a>A-2*y&&(a=A-2*y),a=(a-Z)/R,a<D&&(a=D),qa(a,null)):2===O?(a=k,a<v+2*y&&(a=v+2*y),a=(a-Z)/R,a>S&&(a=S),qa(null,a)):3===O&&(a=(k+Fa-Z)/R,a<D&&(a=D),a>S-oa&&(a=S-oa),qa(a,a+oa));0<I&&I<m-n&&0<k&&k<r?La((Math.floor(k)-V)/C,Math.floor(I)):La(null,null);N(J.alpha)&&(u=!0);N(t.alpha)&&(u=!0);
N(X.alpha)&&(u=!0);N(Q.alpha)&&(u=!0);N(W)&&(u=!0);N(ha)&&(K=!0);for(a=0;a<l.length;a++){var b=l[a];N(b.alpha)&&(u=!0);N(b.previewAlpha)&&(K=!0)}if(K){K=!1;d.clearRect(0,m-n-1,r,n+1);sa=-n/ha.value;Ca=m-ea*sa;for(a=0;a<l.length;a++)if(b=l[a],0!==b.previewAlpha.value){var c=sa,f=Ca;if(0===b.alpha.toValue)c=b.saveScaleY,f=b.saveOffsetY;else{var e=b.max-b.min;e>ha.value&&(c=-n/e,f=m-ea*c)}d.globalAlpha=b.previewAlpha.value;d.lineWidth=cb;Ta(b,1,b.data.length,R,c,Z,f)}v=U*R+Z;A=T*R+Z;d.globalAlpha=G.previewAlpha;
d.beginPath();d.rect(p,m-n,v-p,n);d.rect(A,m-n,r-A-p,n);d.fillStyle=G.preview;d.fill();d.globalAlpha=G.previewBorderAlpha;d.beginPath();d.rect(v,m-n,Da,n);d.rect(A-Da,m-n,Da,n);d.rect(v,m-n,A-v,Ea);d.rect(v,m-Ea,A-v,Ea);d.fillStyle=G.previewBorder;d.fill()}if(u){u=!1;d.clearRect(0,0,r,F+Qa);ia=-(F-db)/W.value;la=F-P*ia;d.strokeStyle=G.line;d.lineWidth=Ua;Va(X);Va(Q);d.globalAlpha=1;d.strokeStyle=G.zeroLine;d.beginPath();d.moveTo(p,F);d.lineTo(r-p,F);d.stroke();for(a=0;a<l.length;a++)b=l[a],0!==b.alpha.value&&
(d.globalAlpha=b.alpha.value,d.lineWidth=eb,Ta(b,da,ja,C,ia,V,la));if(ka)for(d.globalAlpha=1,d.strokeStyle=G.selectLine,d.lineWidth=Ua,d.beginPath(),c=ka*C+V,d.moveTo(c,0),d.lineTo(c,F),d.stroke(),c=q.data[Y],a=0;a<l.length;a++)b=l[a],0!==b.alpha.toValue&&(f=b.data[Y],d.strokeStyle=w.colors[b.name],d.fillStyle=G.circleFill,d.lineWidth=fb,d.beginPath(),d.arc(c*C+V,f*ia+la,gb,0,2*Math.PI),d.stroke(),d.fill());d.fillStyle=G.text;d.font=hb;a=J.delta>t.delta;Wa(J,!a);Wa(t,a);Xa(X);Xa(Q);d.globalAlpha=
1;d.fillText(h(P),p,F+Ya)}}requestAnimationFrame(Ra)}}function Wa(a,b){if(0<a.alpha.value){d.globalAlpha=a.alpha.value;var c=a.delta;b&&(c*=2);var f=Math.min(Math.ceil(T/ba/c)*c,q.data.length);b&&(f-=a.delta);a=Math.max(da-1,1);for(--f;f>=a;f-=c){b=q.data[f];var e=b*C+V,g=0;f===q.data.length-1?g=-Aa:1<f&&(g=-(Aa/2));d.fillText(z(b,!0),e+g,F+ib)}}}function Xa(a){if(0<a.alpha.value){d.globalAlpha=a.alpha.value;for(var b=1;b<pa;b++){var c=P+a.delta*b,f=c*ia+la;d.fillText(h(c,!0),p,f+Ya)}}}function Va(a){if(0<
a.alpha.value){d.globalAlpha=a.alpha.value;for(var b=1;b<pa;b++){var c=(P+a.delta*b)*ia+la;d.beginPath();d.moveTo(p,c);d.lineTo(r-p,c);d.stroke()}}}function Ta(a,b,c,f,e,g,h){d.strokeStyle=w.colors[a.name];d.beginPath();d.lineJoin="bevel";d.lineCap="butt";d.moveTo(q.data[b]*f+g,a.data[b]*e+h);var k=Math.floor((c-b)/(r-2*p));1>k&&(k=1);for(b+=1;b<c;b+=k)d.lineTo(q.data[b]*f+g,a.data[b]*e+h);d.stroke()}var $a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),ab="Sun Mon Tue Wed Thu Fri Sat".split(" "),
ra=f(e,"canvas"),d=ra.getContext("2d"),Za=f(e,"div","checks"),E=f(e,"div","popup");E.style.display="none";var Ma=null,G=null,w=null,q=null,l=null,ya=null,za=null,r=0,m=0,F=0,Ja=6,pa=6,g=window.devicePixelRatio,Qa=32*g,n=38*g,y=20*g,Da=4*g,Ea=1*g,Ua=1*g,cb=1*g,eb=2*g,gb=3*g,fb=4*g,hb=10*g+"px Arial",Ya=-6*g,ib=16*g,Aa=30*g,bb=45*g,db=21*g,p=11*g,Oa="ontouchstart"in window?40:8,ba=0,U=0,P=0,T=0,ca=0,wa=0,W=M(0,400),C=1,ia=1,V=0,la=0,da=0,ja=0,D=0,ea=0,S=0,fa=0,Ba=0,ha=M(0,400),R=1,sa=1,Z=0,Ca=0,ka=
0,Na=0,Y=0,J={delta:1,alpha:M(0,200)},t={delta:1,alpha:M(0,200)},X={delta:1,alpha:M(0,400)},Q={delta:1,alpha:M(0,400)},u=!0,K=!0,H={left:0,top:0},k=0,I=0,ma=0,na=0,Fa=0,oa=0,v=0,A=0,ta=0,O=0;L(document,"mousedown",ua);L(document,"touchstart",Ga);L(document,"mousemove",va);L(document,"touchmove",Ha);L(document,"mouseup",aa);L(document,"touchend",aa);L(document,"touchcancel",aa);var Sa=!1;this.destroy=function(){Sa=!0;x(e);document.removeEventListener("mousedown",ua);document.removeEventListener("touchstart",
Ga);document.removeEventListener("mousemove",va);document.removeEventListener("touchmove",Ha);document.removeEventListener("mouseup",aa);document.removeEventListener("touchend",aa);document.removeEventListener("touchcancel",aa)};requestAnimationFrame(Ra);this.setColors=function(a){G=a;u=K=!0};this.setData=function(a){ya=[];za=[];l=[];x(Za);x(E);Ma=f(E,"div","title");if(2>a.columns.length||3>a.columns[0].length)w=null;else{w=a;a=function(a){for(var b in a)if("x"===a[b])return b;return null}(w.types);
for(var b=0;b<w.columns.length;b++){var c=w.columns[b],d=c[0],e={name:d,data:c,min:0,max:c[1],alpha:M(1,400),previewAlpha:M(1,200)};if(d===a)e.min=c[1],e.max=c[c.length-1],q=e;else{for(var g=2;g<c.length;g++){var h=c[g];h<e.min?e.min=h:h>e.max&&(e.max=h)}l.push(e);2<w.columns.length&&(c=f(Za,"label","checkbox"),c.innerText=w.names[d],e=f(c,"input"),e.setAttribute("data-id",l.length-1),e.checked=!0,e.type="checkbox",L(e,"change",function(a){var b=a.currentTarget.getAttribute("data-id");a=a.currentTarget.checked;
b=l[b];b.saveScaleY=sa;b.saveOffsetY=Ca;B(b.alpha,a?1:0);b.previewAlpha.delay=a?200:0;B(b.previewAlpha,a?1:0);u=K=!0;Ka();xa()}),e=f(c,"span","circle"),e.style.borderColor=w.colors[d],e=f(c,"span","symbol"));c=f(E,"div","column");c.style.color=w.colors[d];ya.push(c);e=f(c,"div","value");za.push(e);f(c,"div","label").innerText=w.names[d]}}ba=q.data[2]-q.data[1];D=q.min;S=q.max;Ba=S-D;Pa();ha.value=ha.toValue;qa(S-Ba/4,S);W.value=W.toValue;u=K=!0}}};
