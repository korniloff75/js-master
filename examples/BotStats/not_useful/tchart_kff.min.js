function TChart(a){function e(a,e){var t=new Date(a),l=B[t.getMonth()]+" "+t.getDate();return e?l:R[t.getDay()]+", "+l}function t(a,e){var t=Math.abs(a);if(t>1e9&&e)return(a/1e9).toFixed(2)+"B";if(t>1e6&&e)return(a/1e6).toFixed(2)+"M";if(t>1e3&&e)return(a/1e3).toFixed(1)+"K";if(t>1){for(var l=t.toFixed(0),n=0>a?"-":"",r=0;r<l.length;r++)n+=l.charAt(r),(l.length-1-r)%3===0&&(n+=" ");return n}return a&&a.toString()}function l(a,e,t){var l=document.createElement(e);return t&&l.classList.add(t),a.appendChild(l),l}function n(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function r(a,e,t){a.addEventListener(e,t,!1)}function o(a,e,t){a.removeEventListener(e,t)}function i(a,e){return{fromValue:a,toValue:a,value:a,startTime:0,duration:e,delay:0}}function u(a,e){a.startTime=he,a.toValue=e,a.fromValue=a.value}function h(a){if(a.value===a.toValue)return!1;var e=(he-a.startTime-a.delay)/a.duration;0>e&&(e=0),e>1&&(e=1);var t=-e*(e-2);return a.value=a.fromValue+(a.toValue-a.fromValue)*t,!0}function v(a){le=ee=(a.clientX-ae.left)*ea,ne=te=(a.clientY-ae.top)*ea;var e=te>G-la&&G>te&&ee>-na&&j+na>ee;e&&(ee>ie-na&&ie+na/2>ee?pe=ce:ee>ue-na/2&&ue+na>ee?pe=fe:ee>ie+na/2&&ue-na/2>ee&&(pe=de,re=ie-ee,oe=Va-wa))}function c(a){v(a.touches[0])}function f(a){le=(a.clientX-ae.left)*ea,ne=(a.clientY-ae.top)*ea}function d(a){f(a.touches[0])}function p(){pe=ve}function s(a){return(a-Ea)/Na}function m(a){return a*Na+Ea}function g(a){return a*La+Fa}function b(a){return(a-Xa)/Ia}function A(a){return a*Ia+Xa}function x(){Sa=Va-wa,Na=(j-2*ba)/Sa,Ea=-wa*Na+ba;for(var a=Sa/ya/Q,e=1;a>=e;)e*=2;a=e,a<Ga.delta?(ja.delta=Ga.delta,ja.alpha.value=1,u(ja.alpha,1),Ga.delta=a,Ga.alpha.value=0,u(Ga.alpha,1)):a>Ga.delta&&(ja.delta=Ga.delta,ja.alpha.value=Ga.alpha.value,u(ja.alpha,0),Ga.delta=a,Ga.alpha.value=1,u(Ga.alpha,1))}function y(){Ta=void 0!==Ma?Ma:Number.MAX_VALUE,ka=Number.MIN_VALUE;for(var a=0;a<q.length;a++){var e=q[a];if(0!==e.alpha.toValue)for(var t=Pa;Ba>t;t++){var l=e.data[t];Ta>l&&(Ta=l),l>ka&&(ka=l)}}ka===Number.MIN_VALUE&&(ka=1);var n=ka-Ta;Ca.toValue!==n&&(u(Ca,n),Ha.delta=Qa.delta,Ha.alpha.value=Qa.alpha.value,u(Ha.alpha,0),Qa.delta=Math.floor(Ca.toValue/Z),Qa.alpha.value=1-Ha.alpha.value,u(Qa.alpha,1))}function M(){Ia=(j-2*ba)/_a,Xa=-Ra*Ia+ba}function w(){Ua=void 0!==Ma?Ma:Number.MAX_VALUE,Ya=Number.MIN_VALUE;for(var a=0;a<q.length;a++){var e=q[a];0!==e.alpha.toValue&&(e.min<Ua&&(Ua=e.min),e.max>Ya&&(Ya=e.max))}Ya===Number.MIN_VALUE&&(Ya=1),u(Da,Ya-Ua)}function T(a,e){var t=!1;null!==a&&wa!==a&&(wa=a,Pa=Math.floor((wa-Ra-ba/Na)/ya)+1,1>Pa&&(Pa=1),t=!0),null!==e&&Va!==e&&(Va=e,Ba=Math.ceil((Va-Ra+ba/Na)/ya)+2,Ba>O.data.length&&(Ba=O.data.length),t=!0),t&&(x(),y(),$a=Za=!0)}function V(a,l){if(qa!==a)if(qa=a,Za=!0,null===qa)Ka=-1,D.style.display="none";else{D.style.display="block";var n=Math.round((a-Ra)/ya)+1;if(1>n&&(n=1),n>O.data.length-1&&(n=O.data.length-1),Ka!==n){Ka=n;var r=O.data[Ka];I.innerText=e(r,!1);for(var o=0;o<q.length;o++){var i=q[o],u=i.data[Ka];z[o].style.display=0===i.alpha.toValue?"none":"block",K[o].innerText=t(u,!1)}}var h=D.getBoundingClientRect(),v=m(a)/ea+Aa;0>v&&(v=0),v+h.width>ae.width&&(v=ae.width-h.width),D.style.left=v+"px"}if(za!==l){za=l,h||(h=D.getBoundingClientRect());var c=l/ea+39-h.height-xa;0>c&&(c=l/ea+39+xa),D.style.top=c+"px"}}function k(){ae=W.getBoundingClientRect();var a=ae.width*ea,e=ae.height*ea;j===a&&G===e||(j=a,G=e,H=G-la-ta,Q=Math.max(1,Math.floor(j/(2*sa))),Z=Math.max(1,Math.floor(H/ma)),W.setAttribute("width",j),W.setAttribute("height",G),x(),y(),M(),w(),Za=$a=!0)}function S(a){if(!se){if(he=a,null!==X&&(k(),j>0&&G>0)){if(pe>0?(ee+=.5*(le-ee),te+=.5*(ne-te)):(ee=le,te=ne),pe===ce){var e=ee;e>ue-2*na&&(e=ue-2*na);var t=b(e);Ra>t&&(t=Ra),T(t,null)}else if(pe===fe){var e=ee;ie+2*na>e&&(e=ie+2*na);var l=b(e);l>Wa&&(l=Wa),T(null,l)}else if(pe===de){var n=ee+re,t=b(n);Ra>t&&(t=Ra),t>Wa-oe&&(t=Wa-oe),T(t,t+oe)}var r=te>0&&G-la>te&&ee>0&&j>ee;r?V(s(Math.floor(ee)),Math.floor(te)):V(null,null),h(ja.alpha)&&(Za=!0),h(Ga.alpha)&&(Za=!0),h(Ha.alpha)&&(Za=!0),h(Qa.alpha)&&(Za=!0),h(Ca)&&(Za=!0),h(Da)&&($a=!0);for(var o=0;o<q.length;o++){var i=q[o];h(i.alpha)&&(Za=!0),h(i.previewAlpha)&&($a=!0)}$a&&($a=!1,E()),Za&&(Za=!1,F())}requestAnimationFrame(S)}}function C(a,t){if(a.alpha.value>0){Y.globalAlpha=a.alpha.value;var l=a.delta;t&&(l*=2);var n=Math.min(Math.ceil(Va/ya/l)*l,O.data.length);t&&(n-=a.delta);for(var r=Math.max(Pa-1,1),o=n-1;o>=r;o-=l){var i=O.data[o],u=m(i),h=0;o===O.data.length-1?h=-sa:o>1&&(h=-(sa/2)),Y.fillText(e(i,!0),u+h,H+pa)}}}function N(a){if(a.alpha.value>0){Y.globalAlpha=a.alpha.value;for(var e=1;Z>e;e++){var l=Ta+a.delta*e,n=g(l);Y.fillText(t(l,!0),ba,n+da)}}}function L(a){if(a.alpha.value>0){Y.globalAlpha=a.alpha.value;for(var e=1;Z>e;e++){var t=Ta+a.delta*e,l=g(t);Y.beginPath(),Y.moveTo(ba,l),Y.lineTo(j-ba,l),Y.stroke()}}}function E(){Y.clearRect(0,G-la-1,j,la+1),Ja=-la/Da.value,Oa=G-Ua*Ja;for(var a=0;a<q.length;a++){var e=q[a];if(0!==e.previewAlpha.value){var t=Ja,l=Oa;if(0===e.alpha.toValue)t=e.saveScaleY,l=e.saveOffsetY;else{var n=e.max-e.min;n>Da.value&&(t=-la/n,l=G-Ua*t)}Y.globalAlpha=e.previewAlpha.value,Y.lineWidth=ua,P(e,1,e.data.length,Ia,t,Xa,l)}}ie=A(wa),ue=A(Va),Y.globalAlpha=J.previewAlpha,Y.beginPath(),Y.rect(ba,G-la,ie-ba,la),Y.rect(ue,G-la,j-ue-ba,la),Y.fillStyle=J.preview,Y.fill(),Y.globalAlpha=J.previewBorderAlpha,Y.beginPath(),Y.rect(ie,G-la,ra,la),Y.rect(ue-ra,G-la,ra,la),Y.rect(ie,G-la,ue-ie,oa),Y.rect(ie,G-oa,ue-ie,oa),Y.fillStyle=J.previewBorder,Y.fill()}function F(){Y.clearRect(0,0,j,H+ta),La=-(H-ga)/Ca.value,Fa=H-Ta*La,Y.strokeStyle=J.line,Y.lineWidth=ia,L(Ha),L(Qa),Y.globalAlpha=1,Y.strokeStyle=J.zeroLine,Y.beginPath(),Y.moveTo(ba,H),Y.lineTo(j-ba,H),Y.stroke();for(var a=0;a<q.length;a++){var e=q[a];0!==e.alpha.value&&(Y.globalAlpha=e.alpha.value,Y.lineWidth=ha,P(e,Pa,Ba,Na,La,Ea,Fa))}if(qa){Y.globalAlpha=1,Y.strokeStyle=J.selectLine,Y.lineWidth=ia,Y.beginPath();var l=m(qa);Y.moveTo(l,0),Y.lineTo(l,H),Y.stroke();for(var l=O.data[Ka],a=0;a<q.length;a++){var e=q[a];if(0!==e.alpha.toValue){var n=e.data[Ka];Y.strokeStyle=X.colors[e.name],Y.fillStyle=J.circleFill,Y.lineWidth=ca,Y.beginPath(),Y.arc(l*Na+Ea,n*La+Fa,va,0,2*Math.PI),Y.stroke(),Y.fill()}}}Y.fillStyle=J.text,Y.font=fa;var r=ja.delta>Ga.delta;C(ja,!r),C(Ga,r),N(Ha),N(Qa),Y.globalAlpha=1,Y.fillText(t(Ta),ba,H+da)}function P(a,e,t,l,n,r,o){Y.strokeStyle=X.colors[a.name],Y.beginPath(),Y.lineJoin="bevel",Y.lineCap="butt";var i=O.data[e],u=a.data[e];Y.moveTo(i*l+r,u*n+o);var h=Math.floor((t-e)/(j-2*ba));1>h&&(h=1);for(var v=e+1;t>v;v+=h){var c=O.data[v],f=a.data[v];Y.lineTo(c*l+r,f*n+o)}Y.stroke()}var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],R=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],U=a.parentNode,W=l(a,"canvas"),Y=W.getContext("2d"),_=l(a,"div","checks"),D=l(a,"div","popup");D.style.display="none";var I=null,J=null,X=null,O=null,q=null,z=null,K=null,j=0,G=0,H=0,Q=6,Z=6,$=400,aa=200,ea=window.devicePixelRatio,ta=32*ea,la=38*ea,na=20*ea,ra=4*ea,oa=1*ea,ia=1*ea,ua=1*ea,ha=2*ea,va=3*ea,ca=4*ea,fa=10*ea+"px Arial",da=-6*ea,pa=16*ea,sa=30*ea,ma=45*ea,ga=21*ea,ba=11*ea,Aa=-25,xa="ontouchstart"in window?40:8,ya=0,Ma=0,wa=0,Ta=0,Va=0,ka=0,Sa=0,Ca=i(0,$),Na=1,La=1,Ea=0,Fa=0,Pa=0,Ba=0,Ra=0,Ua=0,Wa=0,Ya=0,_a=0,Da=i(0,$),Ia=1,Ja=1,Xa=0,Oa=0,qa=0,za=0,Ka=0,ja={delta:1,alpha:i(0,aa)},Ga={delta:1,alpha:i(0,aa)},Ha={delta:1,alpha:i(0,$)},Qa={delta:1,alpha:i(0,$)},Za=!0,$a=!0,ae={left:0,top:0},ee=0,te=0,le=0,ne=0,re=0,oe=0,ie=0,ue=0,he=0,ve=0,ce=1,fe=2,de=3,pe=ve;r(U,"mousedown",v),r(U,"touchstart",c),r(U,"mousemove",f),r(U,"touchmove",d),r(U,"mouseup",p),r(U,"touchend",p),r(U,"touchcancel",p);var se=!1;this.destroy=function(){se=!0,n(a),o(U,"mousedown",v),o(U,"touchstart",c),o(U,"mousemove",f),o(U,"touchmove",d),o(U,"mouseup",p),o(U,"touchend",p),o(U,"touchcancel",p)},requestAnimationFrame(S),this.setColors=function(a){J=a,Za=$a=!0},this.setData=function(a){function e(a){for(var e in a)if("x"===a[e])return e;return null}if(z=[],K=[],q=[],n(_),n(D),I=l(D,"div","title"),a.columns.length<2||a.columns[0].length<3)return void(X=null);X=a;for(var t=e(X.types),o=0;o<X.columns.length;o++){var h=X.columns[o],v=h[0],c={name:v,data:h,min:void 0!==Ma?Ma:h[1],max:h[1],alpha:i(1,$),previewAlpha:i(1,$/2)};if(v===t)c.min=h[1],c.max=h[h.length-1],O=c;else{for(var f=2;f<h.length;f++){var d=h[f];d<c.min?c.min=d:d>c.max&&(c.max=d)}if(q.push(c),X.columns.length>2){var p=l(_,"label","checkbox");p.innerText=X.names[v];var s=l(p,"input");s.setAttribute("data-id",q.length-1),s.checked=!0,s.type="checkbox",r(s,"change",function(a){var e=a.currentTarget.getAttribute("data-id"),t=a.currentTarget.checked,l=q[e];l.saveScaleY=Ja,l.saveOffsetY=Oa,u(l.alpha,t?1:0),l.previewAlpha.delay=t?$/2:0,u(l.previewAlpha,t?1:0),Za=$a=!0,w(),y()});var m=l(p,"span","circle");m.style.borderColor=X.colors[v],m=l(p,"span","symbol")}var g=l(D,"div","column");g.style.color=X.colors[v],z.push(g);var b=l(g,"div","value");K.push(b);var A=l(g,"div","label");A.innerText=X.names[v]}}ya=O.data[2]-O.data[1],Ra=O.min,Wa=O.max,_a=Wa-Ra,k(),Da.value=Da.toValue,T(Wa-_a/4,Wa),Ca.value=Ca.toValue,Za=$a=!0}}